{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"USP Core WAAP","text":"<p>USP Core WAAP (Web Application and API Protection) provides secure access to web-based applications and resources, while simplifying the process of configuration and deployment.</p> <ul> <li>Current USP Core WAAP operator release version: 1.0.0</li> <li>Current Helm charts version for USP Core WAAP operator : 1.0.1</li> <li>Current Core WAAP image: 1.1.8</li> </ul>"},{"location":"#overview","title":"Overview","text":"<p>For Kubernetes we provide the Core WAAP Operator which deploys Core WAAP based on a Custom  Resource with the respective services and pods. With Core WAAP, the security configuration can be fully integrated in applications continuous integration and delivery process  while enabling developers move from DevOps to SecDevOps.</p> <p></p>"},{"location":"#configuring-core-waap","title":"Configuring Core WAAP","text":"<p>A basic Core WAAP configuration looks as follows.</p> <p></p>"},{"location":"#getting-started","title":"Getting Started","text":"<p>To pull the Operator helm chart and corresponding container images you need a key. Get in contact with us, we are looking forward to support you. Web Application &amp; API Protection (WAAP) \u2013 United Security Providers AG</p>"},{"location":"autolearning/","title":"Auto-Learning","text":"<p>USP Core WAAP provides a command-line tool that allows to apply an automated learning mechanism to generate a set of rules for Coraza (ModSecurity/CRS).</p> <p>The tool itself is an executable Java archive (jar) and can be downloaded here.</p> <p>Run with <code>java -jar waap-lib-autolearn-cli-1.0.0.jar --help</code> to see usage:</p> <pre><code>Usage: java -jar waap-lib-autolearn-cli-&lt;version&gt;.jar [-hsV]\n       [--reduceconfigured] [--skipmetadataexport] [--skippostparts]\n       [--sortexceptions] [-e=&lt;error&gt;] [-i=&lt;specIn&gt;] [-l=&lt;log&gt;]\n       [-n=&lt;namespace&gt;] [-o=&lt;specOut&gt;] [-t=&lt;range&gt;] [-w=&lt;instance&gt;]\nAutolearns CRS rule exceptions from USP Core WAAP log files.\nCopyright (c) United Security Providers AG, Switzerland, All rights reserved.\n  -e, --errorfile=&lt;error&gt;    File to write errors to, optional, by default no\n                               file is written.\n  -h, --help                 Show this help message and exit.\n  -i, --waapspecin=&lt;specIn&gt;  USP Core WAAP spec file (or manifest file) to\n                               read, use '-' for stdin, exclusive with -n/-w.\n  -l, --log=&lt;log&gt;            USP Core WAAP log file to parse, exclusive with\n                               -n/-w.\n  -n, --namespace=&lt;namespace&gt;\n                             Kubernetes namespace with USP Core WAAP, exclusive\n                               with -i/-l.\n  -o, --waapspecout=&lt;specOut&gt;\n                             USP Core WAAP spec file (or manifest file) to\n                               write, defaults to 'waap.yaml', use '-' for\n                               stdout (then automatically also -s).\n      --reduceconfigured     Changes already configured exceptions by removing\n                               a) duplicates &amp; b) more specific rules in favor\n                               of more general ones\n  -s, --silent               No output to stdout with number of learned rules\n                               and errors.\n      --skipmetadataexport   Skip metadata export.\n      --skippostparts        Skip part name parsing for ARGS_POST.\n      --sortexceptions       Sort rule exceptions in the output.\n  -t, --timerange=&lt;range&gt;    Optional time range to learn from, e.g.\n                               \"20231201.1010-20231202.1010\" (time with\n                               minutes).\n  -V, --version              Print version information and exit.\n  -w, --waapinstance=&lt;instance&gt;\n                             Kubernetes USP Core WAAP instance name (app.\n                               kubernetes.io/instance), exclusive with -i/-l.\n</code></pre>"},{"location":"crd-doc/","title":"API Reference","text":"<p>Packages:</p> <ul> <li>waap.core.u-s-p.ch/v1alpha1</li> </ul>"},{"location":"crd-doc/#waapcoreu-s-pchv1alpha1","title":"waap.core.u-s-p.ch/v1alpha1","text":"<p>Resource Types:</p> <ul> <li>CoreWaapService</li> </ul>"},{"location":"crd-doc/#corewaapservice","title":"CoreWaapService","text":"<p><sup><sup>\u21a9 Parent</sup></sup></p> Name Type Description Required apiVersion string waap.core.u-s-p.ch/v1alpha1 true kind string CoreWaapService true metadata object Refer to the Kubernetes API documentation for the fields of the `metadata` field. true spec object false status object false"},{"location":"crd-doc/#corewaapservicespec","title":"CoreWaapService.spec","text":"<p><sup><sup>\u21a9 Parent</sup></sup></p> Name Type Description Required routes []object            List of routes to backends (at least one route must be defined)  true authentications []object            List of authentications (OpenID Connect / OAuth 2.0 clients and/or JWT validations) false crs object            OWASP Core Rule Set (CRS) settings (version 4.3.0) false csrfPolicy object            Global CSRF protection (default on). It detects and blocks CSRF attacks based on comparing the request origin (either 'Origin' or 'Referrer' header) with the request target. If the origin does not match the target and is not allowed specifically, the request will be blocked. false headerFiltering object            Global header filtering (default is allow standard headers only) false hostnames []string            List of hostnames (append ports with ':', default is wildcard '*') false nativeConfigPostProcessing []string            JavaScripts for post-processing generated Envoy config false operation object            Operation related settings to be used for the Core WAAP Kubernetes deployment; these settings typically do not affect generated Envoy config (optional, except that the operation's image field must be set in the spec or via default in the operator config) [merge with operator defaults: config trees are merged in detail with precedence given to values in the spec, e.g. resources.limits.cpu could be defined in operator config but resources.requests.cpu in the spec; exception: lists within the config tree are completely overridden by the ones in the spec if present, which affects e.g. tolerations and lists under affinity] false originBlocking object            Origin blocking false webResources object            Resources from a config map to serve as static files and/or to map status codes to error pages with dynamic content false websocket boolean            Allow websocket  Default: false false"},{"location":"crd-doc/#corewaapservicespecroutesindex","title":"CoreWaapService.spec.routes[index]","text":"<p><sup><sup>\u21a9 Parent</sup></sup></p> Name Type Description Required backend object            Backend  true match object            Matching criteria  true auth object            Authentication false autoHostRewrite boolean            Indicates that during forwarding, the host header will be swapped with the hostname of the upstream host  Default: true false crs object            CRS settings per route false"},{"location":"crd-doc/#corewaapservicespecroutesindexbackend","title":"CoreWaapService.spec.routes[index].backend","text":"<p><sup><sup>\u21a9 Parent</sup></sup></p> <p>Backend </p> Name Type Description Required address string            Backend hostname or IP  true port integer            Backend port number  Minimum: 1 Maximum: 65535 true protocol object            Protocol false tls object            TLS false"},{"location":"crd-doc/#corewaapservicespecroutesindexbackendprotocol","title":"CoreWaapService.spec.routes[index].backend.protocol","text":"<p><sup><sup>\u21a9 Parent</sup></sup></p> <p>Protocol</p> Name Type Description Required selection enum            Selection of upstream protocol (h2 uses HTTP/2, h1 uses HTTP/1.1, auto negotiates the protocol using ALPN (requires TLS) with HTTP/2 preferred and HTTP/1.1 as fallback)  Enum: auto, h1, h2 Default: h2 false"},{"location":"crd-doc/#corewaapservicespecroutesindexbackendtls","title":"CoreWaapService.spec.routes[index].backend.tls","text":"<p><sup><sup>\u21a9 Parent</sup></sup></p> <p>TLS</p> Name Type Description Required checkCertificates boolean            Check trusted certificates and SAN  Default: true false enabled boolean            Enable TLS  Default: false false"},{"location":"crd-doc/#corewaapservicespecroutesindexmatch","title":"CoreWaapService.spec.routes[index].match","text":"<p><sup><sup>\u21a9 Parent</sup></sup></p> <p>Matching criteria </p> Name Type Description Required path string            Path (depending on pathType either a regex or a prefix)  true filters object            Filters false headers []object            List of header matchers (logical AND between header matchers and with path) false pathType enum            Path type  Enum: PREFIX, REGEX Default: REGEX false"},{"location":"crd-doc/#corewaapservicespecroutesindexmatchfilters","title":"CoreWaapService.spec.routes[index].match.filters","text":"<p><sup><sup>\u21a9 Parent</sup></sup></p> <p>Filters</p> Name Type Description Required allowedMethods []enum            Allowed http methods (all methods allowed if not specified) false originBlocking object            Origin blocking false rewrite object            Rewrite request false"},{"location":"crd-doc/#corewaapservicespecroutesindexmatchfiltersoriginblocking","title":"CoreWaapService.spec.routes[index].match.filters.originBlocking","text":"<p><sup><sup>\u21a9 Parent</sup></sup></p> <p>Origin blocking</p> Name Type Description Required ips []string            Allowed or denied IP addresses (CIDR notation or single IP, e.g. 1.2.3.4/32 or 1.2.3.4)  true policy enum            Policy (ALLOW or DENY access depending on origin)  Enum: ALLOW, DENY true"},{"location":"crd-doc/#corewaapservicespecroutesindexmatchfiltersrewrite","title":"CoreWaapService.spec.routes[index].match.filters.rewrite","text":"<p><sup><sup>\u21a9 Parent</sup></sup></p> <p>Rewrite request</p> Name Type Description Required url object            URL to set upstream false"},{"location":"crd-doc/#corewaapservicespecroutesindexmatchfiltersrewriteurl","title":"CoreWaapService.spec.routes[index].match.filters.rewrite.url","text":"<p><sup><sup>\u21a9 Parent</sup></sup></p> <p>URL to set upstream</p> Name Type Description Required path string            Path to rewrite (if regex path can use \\1, \\2 etc. to replace matched regex groups)  true"},{"location":"crd-doc/#corewaapservicespecroutesindexmatchheadersindex","title":"CoreWaapService.spec.routes[index].match.headers[index]","text":"<p><sup><sup>\u21a9 Parent</sup></sup></p> Name Type Description Required name string            Request header name  true value string            Request header value (exact match of full string)  true"},{"location":"crd-doc/#corewaapservicespecroutesindexauth","title":"CoreWaapService.spec.routes[index].auth","text":"<p><sup><sup>\u21a9 Parent</sup></sup></p> <p>Authentication</p> Name Type Description Required ref string            Reference to name of corresponding authentication setting  true"},{"location":"crd-doc/#corewaapservicespecroutesindexcrs","title":"CoreWaapService.spec.routes[index].crs","text":"<p><sup><sup>\u21a9 Parent</sup></sup></p> <p>CRS settings per route</p> Name Type Description Required disabled boolean            Whether to disable all CRS parsing for the route or not  Default: false false"},{"location":"crd-doc/#corewaapservicespecauthenticationsindex","title":"CoreWaapService.spec.authentications[index]","text":"<p><sup><sup>\u21a9 Parent</sup></sup></p> Name Type Description Required backend object            Settings for propagation to backend  true jwksEndpoint string            OIDC JWKS endpoint URL, offers credentials to verify JWTs (normally use https)  true name string            Name to reference in routes  true audiences []string            List of accepted JWT audiences (if none is specified the JWT is not matched against the audience list) false authorizationEndpoint string            OIDC OP authorization endpoint URL (omit to mark JWT-only authentication; note that tokenEndpoint and credentials must always also be defined resp. omitted accordingly) false credentials object            OIDC credentials (client_id and client_secret, omit if only using JWT validation) false issuer string            OIDC OP issuer (mandatory for OIDC authentication, optional if JWT-only authentication) false scopes []string            List of scopes to be claimed in the authorization request false tokenEndpoint string            OIDC OP token endpoint URL (omit if JWT-only authentication) false tokenEndpointAuthType enum            How to pass the client_id to the OP (BODY for URL-encoded body parameter, BASIC for basic auth)  Enum: BASIC, BODY Default: BODY false useRefreshToken boolean            Whether to allow automatic access token refresh using the associated refresh token  Default: false false"},{"location":"crd-doc/#corewaapservicespecauthenticationsindexbackend","title":"CoreWaapService.spec.authentications[index].backend","text":"<p><sup><sup>\u21a9 Parent</sup></sup></p> <p>Settings for propagation to backend </p> Name Type Description Required forwardJwt boolean            Whether to forward the JWT to the upstream server  Default: true false jwtClaimToHeader []object            Translations of JWT claims to HTTP headers false"},{"location":"crd-doc/#corewaapservicespecauthenticationsindexbackendjwtclaimtoheaderindex","title":"CoreWaapService.spec.authentications[index].backend.jwtClaimToHeader[index]","text":"<p><sup><sup>\u21a9 Parent</sup></sup></p> Name Type Description Required claim string            Claim to set as header  true headerName string            Name of the header to set to the claim  true"},{"location":"crd-doc/#corewaapservicespecauthenticationsindexcredentials","title":"CoreWaapService.spec.authentications[index].credentials","text":"<p><sup><sup>\u21a9 Parent</sup></sup></p> <p>OIDC credentials (client_id and client_secret, omit if only using JWT validation)</p> Name Type Description Required clientId string            OIDC client_id  true clientSecret string            OIDC client_secret by value (either this or clientSecretRef is mandatory) false clientSecretRef string            OIDC client_secret via reference to Kubernetes secret (recommended, either this or clientSecret is mandatory) false hmacSecret string            HMAC secret by value (either this or hmacSecretRef is mandatory) false hmacSecretRef string            HMAC secret via reference to Kubernetes secret (recommended, either this or hmacSecret is mandatory) false"},{"location":"crd-doc/#corewaapservicespeccrs","title":"CoreWaapService.spec.crs","text":"<p><sup><sup>\u21a9 Parent</sup></sup></p> <p>OWASP Core Rule Set (CRS) settings (version 4.3.0)</p> Name Type Description Required enabledRequestRules []enum            Set of request rule classes (default is to include all rules, rules REQUEST_901_INITIALIZATION and REQUEST_949_BLOCKING_EVALUATION are always included, see https://github.com/coreruleset/coreruleset/tree/v4.3.0/rules for all configurable values, just replace '-' by '_' and omit '.conf') false enabledResponseRules []enum            Set of response rule classes (default is to include no rules, rules RESPONSE_959_BLOCKING_EVALUATION and RESPONSE_980_CORRELATION are always included, see https://github.com/coreruleset/coreruleset/tree/v4.3.0/rules for all configurable values, just replace '-' by '_' and omit '.conf') false mode enum            Mode (BLOCK = traffic identified as suspicious is blocked; DETECT = traffic identified as suspicious is logged but not blocked; DISABLED = traffic is not inspected)  Enum: BLOCK, DETECT, DISABLED Default: BLOCK false paranoiaLevel integer            Paranoia level (the higher the level the better the protection but also more likely false positives, see OWASP CRS for details)  Default: 1 Minimum: 1 Maximum: 4 false parseJson boolean            Whether to apply CRS protection rules for JSON payloads or not  Default: true false parseXml boolean            Whether to apply CRS protection rules for XML payloads or not  Default: true false requestBodyAccess boolean            Whether to scan request bodies or not (if this setting is disabled, POST parameters and other content submitted in the request body will not be inspected)  Default: true false requestBodyAccessExceptions []object            Request body parsing exceptions (locations to exclude from parsing, typically for file uploads) false requestBodyLimitKb integer            Request body limit in KB, body bytes beyond the limit are not parsed (max 1048576 KB (1 GB))  Default: 128 Minimum: 0 Maximum: 1.048576e+06 false requestRuleExceptions []object            Conditionally disable request rules to avoid false positive alerts/blocks false responseBodyLimitKb integer            Response body limit in KB, body bytes beyond the limit are not parsed  Default: 256 Minimum: 0 Maximum: 1.048576e+06 false responseRuleExceptions []object            Conditionally disable response rules to avoid false positive alerts/blocks false securityLevel integer            Defines under which conditions suspicious requests are blocked; only has an effect if the mode is set to BLOCK (security level 5 blocks already if 1 (or more) critical anomalies, 4 if 2, 3 if 3, 2 if 5, 1 if 10)  Default: 5 Minimum: 1 Maximum: 5 false validateJson boolean            Special rule which checks the syntax of JSON requests (if the syntax is invalid and the current mode is BLOCK, such requests are blocked)  Default: true false"},{"location":"crd-doc/#corewaapservicespeccrsrequestbodyaccessexceptionsindex","title":"CoreWaapService.spec.crs.requestBodyAccessExceptions[index]","text":"<p><sup><sup>\u21a9 Parent</sup></sup></p> Name Type Description Required location string            Location for which to skip request body parsing  true methods []enum            HTTP method(s) for which to skip request body parsing (at least one must be defined)  true regEx boolean            Whether the location is indicated as a regex or not  Default: false false"},{"location":"crd-doc/#corewaapservicespeccrsrequestruleexceptionsindex","title":"CoreWaapService.spec.crs.requestRuleExceptions[index]","text":"<p><sup><sup>\u21a9 Parent</sup></sup></p> Name Type Description Required ruleId integer            Rule ID  true location string            Location false metadata object            Metadata (no impact on native config) false regEx boolean            Whether the location is indicated as a regex or not  Default: false false requestPartName string            Request part name (e.g. 'User-Agent') false requestPartType enum            Request part type Enum: ARGS, ARGS_COMBINED_SIZE, ARGS_GET, ARGS_GET_NAMES, ARGS_NAMES, ARGS_POST, ARGS_POST_NAMES, AUTH_TYPE, DURATION, ENV, FILES, FILES_COMBINED_SIZE, FILES_NAMES, FILES_SIZES, FILES_TMPNAMES, FILES_TMP_CONTENT, FULL_REQUEST, FULL_REQUEST_LENGTH, GEO, HIGHEST_SEVERITY, INBOUND_DATA_ERROR, MATCHED_VAR, MATCHED_VARS, MATCHED_VARS_NAMES, MATCHED_VAR_NAME, MODSEC_BUILD, MULTIPART_CRLF_LF_LINES, MULTIPART_FILENAME, MULTIPART_NAME, MULTIPART_PART_HEADERS, MULTIPART_STRICT_ERROR, MULTIPART_UNMATCHED_BOUNDARY, OUTBOUND_DATA_ERROR, PATH_INFO, PERF_COMBINED, PERF_GC, PERF_LOGGING, PERF_PHASE1, PERF_PHASE2, PERF_PHASE3, PERF_PHASE4, PERF_PHASE5, PERF_RULES, PERF_SREAD, PERF_SWRITE, QUERY_STRING, REMOTE_ADDR, REMOTE_HOST, REMOTE_PORT, REMOTE_USER, REQBODY_ERROR, REQBODY_ERROR_MSG, REQBODY_PROCESSOR, REQUEST_BASENAME, REQUEST_BODY, REQUEST_BODY_LENGTH, REQUEST_COOKIES, REQUEST_COOKIES_NAMES, REQUEST_FILENAME, REQUEST_HEADERS, REQUEST_HEADERS_NAMES, REQUEST_LINE, REQUEST_METHOD, REQUEST_PROTOCOL, REQUEST_URI, REQUEST_URI_RAW, RESPONSE_BODY, RESPONSE_CONTENT_LENGTH, RESPONSE_CONTENT_TYPE, RESPONSE_HEADERS, RESPONSE_HEADERS_NAMES, RESPONSE_PROTOCOL, RESPONSE_STATUS, RULE, SCRIPT_BASENAME, SCRIPT_FILENAME, SCRIPT_GID, SCRIPT_GROUPNAME, SCRIPT_MODE, SCRIPT_UID, SCRIPT_USERNAME, SDBM_DELETE_ERROR, SERVER_ADDR, SERVER_NAME, SERVER_PORT, SESSION, SESSIONID, STREAM_INPUT_BODY, STREAM_OUTPUT_BODY, TIME, TIME_DAY, TIME_EPOCH, TIME_HOUR, TIME_MIN, TIME_MON, TIME_SEC, TIME_WDAY, TIME_YEAR, TX, UNIQUE_ID, URLENCODED_ERROR, USERAGENT_IP, USERID, WEBAPPID, WEBSERVER_ERROR_LOG, XML false"},{"location":"crd-doc/#corewaapservicespeccrsrequestruleexceptionsindexmetadata","title":"CoreWaapService.spec.crs.requestRuleExceptions[index].metadata","text":"<p><sup><sup>\u21a9 Parent</sup></sup></p> <p>Metadata (no impact on native config)</p> Name Type Description Required comment string            Comment why the rule exception was added false createdBy string            By whom the rule exception was added false date string            Date when the rule exception was added false"},{"location":"crd-doc/#corewaapservicespeccrsresponseruleexceptionsindex","title":"CoreWaapService.spec.crs.responseRuleExceptions[index]","text":"<p><sup><sup>\u21a9 Parent</sup></sup></p> Name Type Description Required ruleId integer            Rule ID  true location string            Location false metadata object            Metadata (no impact on native config) false regEx boolean            Whether the location is indicated as a regex or not  Default: false false requestPartName string            Request part name (e.g. 'User-Agent') false requestPartType enum            Request part type Enum: ARGS, ARGS_COMBINED_SIZE, ARGS_GET, ARGS_GET_NAMES, ARGS_NAMES, ARGS_POST, ARGS_POST_NAMES, AUTH_TYPE, DURATION, ENV, FILES, FILES_COMBINED_SIZE, FILES_NAMES, FILES_SIZES, FILES_TMPNAMES, FILES_TMP_CONTENT, FULL_REQUEST, FULL_REQUEST_LENGTH, GEO, HIGHEST_SEVERITY, INBOUND_DATA_ERROR, MATCHED_VAR, MATCHED_VARS, MATCHED_VARS_NAMES, MATCHED_VAR_NAME, MODSEC_BUILD, MULTIPART_CRLF_LF_LINES, MULTIPART_FILENAME, MULTIPART_NAME, MULTIPART_PART_HEADERS, MULTIPART_STRICT_ERROR, MULTIPART_UNMATCHED_BOUNDARY, OUTBOUND_DATA_ERROR, PATH_INFO, PERF_COMBINED, PERF_GC, PERF_LOGGING, PERF_PHASE1, PERF_PHASE2, PERF_PHASE3, PERF_PHASE4, PERF_PHASE5, PERF_RULES, PERF_SREAD, PERF_SWRITE, QUERY_STRING, REMOTE_ADDR, REMOTE_HOST, REMOTE_PORT, REMOTE_USER, REQBODY_ERROR, REQBODY_ERROR_MSG, REQBODY_PROCESSOR, REQUEST_BASENAME, REQUEST_BODY, REQUEST_BODY_LENGTH, REQUEST_COOKIES, REQUEST_COOKIES_NAMES, REQUEST_FILENAME, REQUEST_HEADERS, REQUEST_HEADERS_NAMES, REQUEST_LINE, REQUEST_METHOD, REQUEST_PROTOCOL, REQUEST_URI, REQUEST_URI_RAW, RESPONSE_BODY, RESPONSE_CONTENT_LENGTH, RESPONSE_CONTENT_TYPE, RESPONSE_HEADERS, RESPONSE_HEADERS_NAMES, RESPONSE_PROTOCOL, RESPONSE_STATUS, RULE, SCRIPT_BASENAME, SCRIPT_FILENAME, SCRIPT_GID, SCRIPT_GROUPNAME, SCRIPT_MODE, SCRIPT_UID, SCRIPT_USERNAME, SDBM_DELETE_ERROR, SERVER_ADDR, SERVER_NAME, SERVER_PORT, SESSION, SESSIONID, STREAM_INPUT_BODY, STREAM_OUTPUT_BODY, TIME, TIME_DAY, TIME_EPOCH, TIME_HOUR, TIME_MIN, TIME_MON, TIME_SEC, TIME_WDAY, TIME_YEAR, TX, UNIQUE_ID, URLENCODED_ERROR, USERAGENT_IP, USERID, WEBAPPID, WEBSERVER_ERROR_LOG, XML false"},{"location":"crd-doc/#corewaapservicespeccrsresponseruleexceptionsindexmetadata","title":"CoreWaapService.spec.crs.responseRuleExceptions[index].metadata","text":"<p><sup><sup>\u21a9 Parent</sup></sup></p> <p>Metadata (no impact on native config)</p> Name Type Description Required comment string            Comment why the rule exception was added false createdBy string            By whom the rule exception was added false date string            Date when the rule exception was added false"},{"location":"crd-doc/#corewaapservicespeccsrfpolicy","title":"CoreWaapService.spec.csrfPolicy","text":"<p><sup><sup>\u21a9 Parent</sup></sup></p> <p>Global CSRF protection (default on). It detects and blocks CSRF attacks based on comparing the request origin (either 'Origin' or 'Referrer' header) with the request target. If the origin does not match the target and is not allowed specifically, the request will be blocked.</p> Name Type Description Required additionalOrigins []string            Additional allowed origin values, specified as '{hostname}[:{port}]' (no scheme!); must correspond to the request target. false enabled boolean            Whether CSRF protection is enabled or not  Default: true false"},{"location":"crd-doc/#corewaapservicespecheaderfiltering","title":"CoreWaapService.spec.headerFiltering","text":"<p><sup><sup>\u21a9 Parent</sup></sup></p> <p>Global header filtering (default is allow standard headers only)</p> Name Type Description Required request object            Request header filtering false response object            Response header filtering false"},{"location":"crd-doc/#corewaapservicespecheaderfilteringrequest","title":"CoreWaapService.spec.headerFiltering.request","text":"<p><sup><sup>\u21a9 Parent</sup></sup></p> <p>Request header filtering</p> Name Type Description Required allow []string            List of allowed header names in addition to ones in allowClass false allowClass enum            A common preset of allowed headers. Values: MINIMAL, STANDARD, RESTRICTED  Enum: MINIMAL, RESTRICTED, STANDARD Default: STANDARD false deny []object            List of denied header names; applied after allowClass &amp; allow false enabled boolean            Whether request header filtering is enabled or not  Default: true false"},{"location":"crd-doc/#corewaapservicespecheaderfilteringrequestdenyindex","title":"CoreWaapService.spec.headerFiltering.request.deny[index]","text":"<p><sup><sup>\u21a9 Parent</sup></sup></p> Name Type Description Required name string            Denied header name; '*' could be used in conjunction with non-blank valuePattern to match all header names false valuePattern string            Lua pattern for denied header value (see https://www.lua.org/pil/20.2.html) false"},{"location":"crd-doc/#corewaapservicespecheaderfilteringresponse","title":"CoreWaapService.spec.headerFiltering.response","text":"<p><sup><sup>\u21a9 Parent</sup></sup></p> <p>Response header filtering</p> Name Type Description Required allow []string            List of allowed header names false deny []string            List of denied header names; applied after allow false enabled boolean            Whether response header filtering is enabled or not  Default: true false"},{"location":"crd-doc/#corewaapservicespecoperation","title":"CoreWaapService.spec.operation","text":"<p><sup><sup>\u21a9 Parent</sup></sup></p> <p>Operation related settings to be used for the Core WAAP Kubernetes deployment; these settings typically do not affect generated Envoy config (optional, except that the operation's image field must be set in the spec or via default in the operator config) [merge with operator defaults: config trees are merged in detail with precedence given to values in the spec, e.g. resources.limits.cpu could be defined in operator config but resources.requests.cpu in the spec; exception: lists within the config tree are completely overridden by the ones in the spec if present, which affects e.g. tolerations and lists under affinity]</p> Name Type Description Required adminInterfaceService object            Settings for exposing the Envoy admin interface as a Kubernetes service false affinity object            Kubernetes affinity for the Core Waap pod false caCertificates object            CA Certificates for the pod, mounted at /etc/ssl/certs/ca-certificates.crt (default is to use the file from container) false image string            Core WAAP container image, must contain a version (must be defined either in spec or operator defaults) false labels map[string]string            Map of key/value labels for the pod false port integer            Port of the Kubernetes service and Envoy listener in the Core WAAP container  Default: 8080 Minimum: 1 Maximum: 65535 false priorityClassName string            Kubernetes priorityClassName for the Core Waap pod false replicas integer            Number of replicas (default is not managed by operator)  Minimum: 1 false resources object            Kubernetes resources for the Core Waap pod false serviceAccount object            Service account false serviceAnnotations map[string]string            Map of key/value annotations for the service false tolerations []object            Kubernetes tolerations for the Core Waap pod false"},{"location":"crd-doc/#corewaapservicespecoperationadmininterfaceservice","title":"CoreWaapService.spec.operation.adminInterfaceService","text":"<p><sup><sup>\u21a9 Parent</sup></sup></p> <p>Settings for exposing the Envoy admin interface as a Kubernetes service</p> Name Type Description Required enabled boolean            Whether the Envoy admin interface should be exposed as Kubernetes service  Default: false false port integer            Port of the Kubernetes service (if enabled) and Envoy admin interface listener in the Core WAAP container  Default: 9901 Minimum: 1 Maximum: 65535 false"},{"location":"crd-doc/#corewaapservicespecoperationaffinity","title":"CoreWaapService.spec.operation.affinity","text":"<p><sup><sup>\u21a9 Parent</sup></sup></p> <p>Kubernetes affinity for the Core Waap pod</p> Name Type Description Required nodeAffinity object false podAffinity object false podAntiAffinity object false"},{"location":"crd-doc/#corewaapservicespecoperationaffinitynodeaffinity","title":"CoreWaapService.spec.operation.affinity.nodeAffinity","text":"<p><sup><sup>\u21a9 Parent</sup></sup></p> Name Type Description Required preferredDuringSchedulingIgnoredDuringExecution []object false requiredDuringSchedulingIgnoredDuringExecution object false"},{"location":"crd-doc/#corewaapservicespecoperationaffinitynodeaffinitypreferredduringschedulingignoredduringexecutionindex","title":"CoreWaapService.spec.operation.affinity.nodeAffinity.preferredDuringSchedulingIgnoredDuringExecution[index]","text":"<p><sup><sup>\u21a9 Parent</sup></sup></p> Name Type Description Required preference object false weight integer false"},{"location":"crd-doc/#corewaapservicespecoperationaffinitynodeaffinitypreferredduringschedulingignoredduringexecutionindexpreference","title":"CoreWaapService.spec.operation.affinity.nodeAffinity.preferredDuringSchedulingIgnoredDuringExecution[index].preference","text":"<p><sup><sup>\u21a9 Parent</sup></sup></p> Name Type Description Required matchExpressions []object false matchFields []object false"},{"location":"crd-doc/#corewaapservicespecoperationaffinitynodeaffinitypreferredduringschedulingignoredduringexecutionindexpreferencematchexpressionsindex","title":"CoreWaapService.spec.operation.affinity.nodeAffinity.preferredDuringSchedulingIgnoredDuringExecution[index].preference.matchExpressions[index]","text":"<p><sup><sup>\u21a9 Parent</sup></sup></p> Name Type Description Required key string false operator string false values []string false"},{"location":"crd-doc/#corewaapservicespecoperationaffinitynodeaffinitypreferredduringschedulingignoredduringexecutionindexpreferencematchfieldsindex","title":"CoreWaapService.spec.operation.affinity.nodeAffinity.preferredDuringSchedulingIgnoredDuringExecution[index].preference.matchFields[index]","text":"<p><sup><sup>\u21a9 Parent</sup></sup></p> Name Type Description Required key string false operator string false values []string false"},{"location":"crd-doc/#corewaapservicespecoperationaffinitynodeaffinityrequiredduringschedulingignoredduringexecution","title":"CoreWaapService.spec.operation.affinity.nodeAffinity.requiredDuringSchedulingIgnoredDuringExecution","text":"<p><sup><sup>\u21a9 Parent</sup></sup></p> Name Type Description Required nodeSelectorTerms []object false"},{"location":"crd-doc/#corewaapservicespecoperationaffinitynodeaffinityrequiredduringschedulingignoredduringexecutionnodeselectortermsindex","title":"CoreWaapService.spec.operation.affinity.nodeAffinity.requiredDuringSchedulingIgnoredDuringExecution.nodeSelectorTerms[index]","text":"<p><sup><sup>\u21a9 Parent</sup></sup></p> Name Type Description Required matchExpressions []object false matchFields []object false"},{"location":"crd-doc/#corewaapservicespecoperationaffinitynodeaffinityrequiredduringschedulingignoredduringexecutionnodeselectortermsindexmatchexpressionsindex","title":"CoreWaapService.spec.operation.affinity.nodeAffinity.requiredDuringSchedulingIgnoredDuringExecution.nodeSelectorTerms[index].matchExpressions[index]","text":"<p><sup><sup>\u21a9 Parent</sup></sup></p> Name Type Description Required key string false operator string false values []string false"},{"location":"crd-doc/#corewaapservicespecoperationaffinitynodeaffinityrequiredduringschedulingignoredduringexecutionnodeselectortermsindexmatchfieldsindex","title":"CoreWaapService.spec.operation.affinity.nodeAffinity.requiredDuringSchedulingIgnoredDuringExecution.nodeSelectorTerms[index].matchFields[index]","text":"<p><sup><sup>\u21a9 Parent</sup></sup></p> Name Type Description Required key string false operator string false values []string false"},{"location":"crd-doc/#corewaapservicespecoperationaffinitypodaffinity","title":"CoreWaapService.spec.operation.affinity.podAffinity","text":"<p><sup><sup>\u21a9 Parent</sup></sup></p> Name Type Description Required preferredDuringSchedulingIgnoredDuringExecution []object false requiredDuringSchedulingIgnoredDuringExecution []object false"},{"location":"crd-doc/#corewaapservicespecoperationaffinitypodaffinitypreferredduringschedulingignoredduringexecutionindex","title":"CoreWaapService.spec.operation.affinity.podAffinity.preferredDuringSchedulingIgnoredDuringExecution[index]","text":"<p><sup><sup>\u21a9 Parent</sup></sup></p> Name Type Description Required podAffinityTerm object false weight integer false"},{"location":"crd-doc/#corewaapservicespecoperationaffinitypodaffinitypreferredduringschedulingignoredduringexecutionindexpodaffinityterm","title":"CoreWaapService.spec.operation.affinity.podAffinity.preferredDuringSchedulingIgnoredDuringExecution[index].podAffinityTerm","text":"<p><sup><sup>\u21a9 Parent</sup></sup></p> Name Type Description Required labelSelector object false matchLabelKeys []string false mismatchLabelKeys []string false namespaceSelector object false namespaces []string false topologyKey string false"},{"location":"crd-doc/#corewaapservicespecoperationaffinitypodaffinitypreferredduringschedulingignoredduringexecutionindexpodaffinitytermlabelselector","title":"CoreWaapService.spec.operation.affinity.podAffinity.preferredDuringSchedulingIgnoredDuringExecution[index].podAffinityTerm.labelSelector","text":"<p><sup><sup>\u21a9 Parent</sup></sup></p> Name Type Description Required matchExpressions []object false matchLabels map[string]string false"},{"location":"crd-doc/#corewaapservicespecoperationaffinitypodaffinitypreferredduringschedulingignoredduringexecutionindexpodaffinitytermlabelselectormatchexpressionsindex","title":"CoreWaapService.spec.operation.affinity.podAffinity.preferredDuringSchedulingIgnoredDuringExecution[index].podAffinityTerm.labelSelector.matchExpressions[index]","text":"<p><sup><sup>\u21a9 Parent</sup></sup></p> Name Type Description Required key string false operator string false values []string false"},{"location":"crd-doc/#corewaapservicespecoperationaffinitypodaffinitypreferredduringschedulingignoredduringexecutionindexpodaffinitytermnamespaceselector","title":"CoreWaapService.spec.operation.affinity.podAffinity.preferredDuringSchedulingIgnoredDuringExecution[index].podAffinityTerm.namespaceSelector","text":"<p><sup><sup>\u21a9 Parent</sup></sup></p> Name Type Description Required matchExpressions []object false matchLabels map[string]string false"},{"location":"crd-doc/#corewaapservicespecoperationaffinitypodaffinitypreferredduringschedulingignoredduringexecutionindexpodaffinitytermnamespaceselectormatchexpressionsindex","title":"CoreWaapService.spec.operation.affinity.podAffinity.preferredDuringSchedulingIgnoredDuringExecution[index].podAffinityTerm.namespaceSelector.matchExpressions[index]","text":"<p><sup><sup>\u21a9 Parent</sup></sup></p> Name Type Description Required key string false operator string false values []string false"},{"location":"crd-doc/#corewaapservicespecoperationaffinitypodaffinityrequiredduringschedulingignoredduringexecutionindex","title":"CoreWaapService.spec.operation.affinity.podAffinity.requiredDuringSchedulingIgnoredDuringExecution[index]","text":"<p><sup><sup>\u21a9 Parent</sup></sup></p> Name Type Description Required labelSelector object false matchLabelKeys []string false mismatchLabelKeys []string false namespaceSelector object false namespaces []string false topologyKey string false"},{"location":"crd-doc/#corewaapservicespecoperationaffinitypodaffinityrequiredduringschedulingignoredduringexecutionindexlabelselector","title":"CoreWaapService.spec.operation.affinity.podAffinity.requiredDuringSchedulingIgnoredDuringExecution[index].labelSelector","text":"<p><sup><sup>\u21a9 Parent</sup></sup></p> Name Type Description Required matchExpressions []object false matchLabels map[string]string false"},{"location":"crd-doc/#corewaapservicespecoperationaffinitypodaffinityrequiredduringschedulingignoredduringexecutionindexlabelselectormatchexpressionsindex","title":"CoreWaapService.spec.operation.affinity.podAffinity.requiredDuringSchedulingIgnoredDuringExecution[index].labelSelector.matchExpressions[index]","text":"<p><sup><sup>\u21a9 Parent</sup></sup></p> Name Type Description Required key string false operator string false values []string false"},{"location":"crd-doc/#corewaapservicespecoperationaffinitypodaffinityrequiredduringschedulingignoredduringexecutionindexnamespaceselector","title":"CoreWaapService.spec.operation.affinity.podAffinity.requiredDuringSchedulingIgnoredDuringExecution[index].namespaceSelector","text":"<p><sup><sup>\u21a9 Parent</sup></sup></p> Name Type Description Required matchExpressions []object false matchLabels map[string]string false"},{"location":"crd-doc/#corewaapservicespecoperationaffinitypodaffinityrequiredduringschedulingignoredduringexecutionindexnamespaceselectormatchexpressionsindex","title":"CoreWaapService.spec.operation.affinity.podAffinity.requiredDuringSchedulingIgnoredDuringExecution[index].namespaceSelector.matchExpressions[index]","text":"<p><sup><sup>\u21a9 Parent</sup></sup></p> Name Type Description Required key string false operator string false values []string false"},{"location":"crd-doc/#corewaapservicespecoperationaffinitypodantiaffinity","title":"CoreWaapService.spec.operation.affinity.podAntiAffinity","text":"<p><sup><sup>\u21a9 Parent</sup></sup></p> Name Type Description Required preferredDuringSchedulingIgnoredDuringExecution []object false requiredDuringSchedulingIgnoredDuringExecution []object false"},{"location":"crd-doc/#corewaapservicespecoperationaffinitypodantiaffinitypreferredduringschedulingignoredduringexecutionindex","title":"CoreWaapService.spec.operation.affinity.podAntiAffinity.preferredDuringSchedulingIgnoredDuringExecution[index]","text":"<p><sup><sup>\u21a9 Parent</sup></sup></p> Name Type Description Required podAffinityTerm object false weight integer false"},{"location":"crd-doc/#corewaapservicespecoperationaffinitypodantiaffinitypreferredduringschedulingignoredduringexecutionindexpodaffinityterm","title":"CoreWaapService.spec.operation.affinity.podAntiAffinity.preferredDuringSchedulingIgnoredDuringExecution[index].podAffinityTerm","text":"<p><sup><sup>\u21a9 Parent</sup></sup></p> Name Type Description Required labelSelector object false matchLabelKeys []string false mismatchLabelKeys []string false namespaceSelector object false namespaces []string false topologyKey string false"},{"location":"crd-doc/#corewaapservicespecoperationaffinitypodantiaffinitypreferredduringschedulingignoredduringexecutionindexpodaffinitytermlabelselector","title":"CoreWaapService.spec.operation.affinity.podAntiAffinity.preferredDuringSchedulingIgnoredDuringExecution[index].podAffinityTerm.labelSelector","text":"<p><sup><sup>\u21a9 Parent</sup></sup></p> Name Type Description Required matchExpressions []object false matchLabels map[string]string false"},{"location":"crd-doc/#corewaapservicespecoperationaffinitypodantiaffinitypreferredduringschedulingignoredduringexecutionindexpodaffinitytermlabelselectormatchexpressionsindex","title":"CoreWaapService.spec.operation.affinity.podAntiAffinity.preferredDuringSchedulingIgnoredDuringExecution[index].podAffinityTerm.labelSelector.matchExpressions[index]","text":"<p><sup><sup>\u21a9 Parent</sup></sup></p> Name Type Description Required key string false operator string false values []string false"},{"location":"crd-doc/#corewaapservicespecoperationaffinitypodantiaffinitypreferredduringschedulingignoredduringexecutionindexpodaffinitytermnamespaceselector","title":"CoreWaapService.spec.operation.affinity.podAntiAffinity.preferredDuringSchedulingIgnoredDuringExecution[index].podAffinityTerm.namespaceSelector","text":"<p><sup><sup>\u21a9 Parent</sup></sup></p> Name Type Description Required matchExpressions []object false matchLabels map[string]string false"},{"location":"crd-doc/#corewaapservicespecoperationaffinitypodantiaffinitypreferredduringschedulingignoredduringexecutionindexpodaffinitytermnamespaceselectormatchexpressionsindex","title":"CoreWaapService.spec.operation.affinity.podAntiAffinity.preferredDuringSchedulingIgnoredDuringExecution[index].podAffinityTerm.namespaceSelector.matchExpressions[index]","text":"<p><sup><sup>\u21a9 Parent</sup></sup></p> Name Type Description Required key string false operator string false values []string false"},{"location":"crd-doc/#corewaapservicespecoperationaffinitypodantiaffinityrequiredduringschedulingignoredduringexecutionindex","title":"CoreWaapService.spec.operation.affinity.podAntiAffinity.requiredDuringSchedulingIgnoredDuringExecution[index]","text":"<p><sup><sup>\u21a9 Parent</sup></sup></p> Name Type Description Required labelSelector object false matchLabelKeys []string false mismatchLabelKeys []string false namespaceSelector object false namespaces []string false topologyKey string false"},{"location":"crd-doc/#corewaapservicespecoperationaffinitypodantiaffinityrequiredduringschedulingignoredduringexecutionindexlabelselector","title":"CoreWaapService.spec.operation.affinity.podAntiAffinity.requiredDuringSchedulingIgnoredDuringExecution[index].labelSelector","text":"<p><sup><sup>\u21a9 Parent</sup></sup></p> Name Type Description Required matchExpressions []object false matchLabels map[string]string false"},{"location":"crd-doc/#corewaapservicespecoperationaffinitypodantiaffinityrequiredduringschedulingignoredduringexecutionindexlabelselectormatchexpressionsindex","title":"CoreWaapService.spec.operation.affinity.podAntiAffinity.requiredDuringSchedulingIgnoredDuringExecution[index].labelSelector.matchExpressions[index]","text":"<p><sup><sup>\u21a9 Parent</sup></sup></p> Name Type Description Required key string false operator string false values []string false"},{"location":"crd-doc/#corewaapservicespecoperationaffinitypodantiaffinityrequiredduringschedulingignoredduringexecutionindexnamespaceselector","title":"CoreWaapService.spec.operation.affinity.podAntiAffinity.requiredDuringSchedulingIgnoredDuringExecution[index].namespaceSelector","text":"<p><sup><sup>\u21a9 Parent</sup></sup></p> Name Type Description Required matchExpressions []object false matchLabels map[string]string false"},{"location":"crd-doc/#corewaapservicespecoperationaffinitypodantiaffinityrequiredduringschedulingignoredduringexecutionindexnamespaceselectormatchexpressionsindex","title":"CoreWaapService.spec.operation.affinity.podAntiAffinity.requiredDuringSchedulingIgnoredDuringExecution[index].namespaceSelector.matchExpressions[index]","text":"<p><sup><sup>\u21a9 Parent</sup></sup></p> Name Type Description Required key string false operator string false values []string false"},{"location":"crd-doc/#corewaapservicespecoperationcacertificates","title":"CoreWaapService.spec.operation.caCertificates","text":"<p><sup><sup>\u21a9 Parent</sup></sup></p> <p>CA Certificates for the pod, mounted at /etc/ssl/certs/ca-certificates.crt (default is to use the file from container)</p> Name Type Description Required configMap string            Name of the config map that contains the CA certificates  true key string            Key (as in 'YAML key/value pair') in the config map that contains the CA certificates  true"},{"location":"crd-doc/#corewaapservicespecoperationresources","title":"CoreWaapService.spec.operation.resources","text":"<p><sup><sup>\u21a9 Parent</sup></sup></p> <p>Kubernetes resources for the Core Waap pod</p> Name Type Description Required claims []object false limits map[string]int or string false requests map[string]int or string false"},{"location":"crd-doc/#corewaapservicespecoperationresourcesclaimsindex","title":"CoreWaapService.spec.operation.resources.claims[index]","text":"<p><sup><sup>\u21a9 Parent</sup></sup></p> Name Type Description Required name string false"},{"location":"crd-doc/#corewaapservicespecoperationserviceaccount","title":"CoreWaapService.spec.operation.serviceAccount","text":"<p><sup><sup>\u21a9 Parent</sup></sup></p> <p>Service account</p> Name Type Description Required automountToken boolean            Whether to automount the token for the service account  Default: true false name string            Service account name  Default: default false"},{"location":"crd-doc/#corewaapservicespecoperationtolerationsindex","title":"CoreWaapService.spec.operation.tolerations[index]","text":"<p><sup><sup>\u21a9 Parent</sup></sup></p> Name Type Description Required effect string false key string false operator string false tolerationSeconds integer false value string false"},{"location":"crd-doc/#corewaapservicespecoriginblocking","title":"CoreWaapService.spec.originBlocking","text":"<p><sup><sup>\u21a9 Parent</sup></sup></p> <p>Origin blocking</p> Name Type Description Required ips []string            Allowed or denied IP addresses (CIDR notation or single IP, e.g. 1.2.3.4/32 or 1.2.3.4)  true policy enum            Policy (ALLOW or DENY access depending on origin)  Enum: ALLOW, DENY true"},{"location":"crd-doc/#corewaapservicespecwebresources","title":"CoreWaapService.spec.webResources","text":"<p><sup><sup>\u21a9 Parent</sup></sup></p> <p>Resources from a config map to serve as static files and/or to map status codes to error pages with dynamic content</p> Name Type Description Required configMap string            Name of the config map that contains the web resources  true path string            Path where static pages will be served (must begin and end with /)  true errorPages []object            List of error pages to serve (allows dynamic content, e.g. %PROTOCOL%) false staticFiles []object            List of static file resources to serve (no dynamic content) false"},{"location":"crd-doc/#corewaapservicespecwebresourceserrorpagesindex","title":"CoreWaapService.spec.webResources.errorPages[index]","text":"<p><sup><sup>\u21a9 Parent</sup></sup></p> Name Type Description Required key string            Key in the config map, used as filename (Content-Type guessed from filename, encoding utf-8 for text/*)  true statusCode string            Status code to apply to (also allows to e.g. use '4xx' for all client errors 400-499)  true mappedStatusCode integer            Status code to send to client (defaults to upstream status code) false"},{"location":"crd-doc/#corewaapservicespecwebresourcesstaticfilesindex","title":"CoreWaapService.spec.webResources.staticFiles[index]","text":"<p><sup><sup>\u21a9 Parent</sup></sup></p> Name Type Description Required key string            Key in the config map, used as filename (Content-Type guessed from filename, encoding utf-8 for text/*)  true"},{"location":"crd-doc/#corewaapservicestatus","title":"CoreWaapService.status","text":"<p><sup><sup>\u21a9 Parent</sup></sup></p> Name Type Description Required status string false"},{"location":"documentation/","title":"Documentation","text":"<p>TBD</p>"},{"location":"downloads/","title":"Downloads","text":""},{"location":"downloads/#demo-apps","title":"Demo Apps","text":"<ul> <li>Juiceshop: juiceshop.zip</li> <li>Httpbin: httpbin.zip</li> </ul>"},{"location":"downloads/#auto-learning-tool","title":"Auto-Learning Tool","text":"<ul> <li>Executable Jar: waap-lib-autolearn-cli-1.0.0.jar</li> </ul>"},{"location":"downloads/#logs-and-metrics","title":"Logs and Metrics","text":"<ul> <li>Opensearch template: opensearch-dashboard-objects.ndjson</li> <li>Grafana template: grafana-dashboard.json</li> </ul>"},{"location":"error-pages-static-files/","title":"Error Pages / Static Files","text":"<p>Configuration samples that show how to configure custom error pages and static web resources.</p> <p>The main purpose of custom error pages is to hide internals of the web application backend (and the Core WAAP itself) from potential attackers who could otherwise gather information about vulnerabilities. HTML error status codes (e.g. 403, 500) can be mapped to error pages that can be customized by including information relevant for support calls, and they can be designed uniformly in your corporate design.</p> <p>Static web resources like a company logo or CSS style sheet can be referenced from error pages and static web pages can also be served individually.</p> <p></p>"},{"location":"error-pages-static-files/#html-error-page-for-all-4xx-errors-with-style-and-logo","title":"HTML error page for all 4xx errors with style and logo","text":"<p>A simple HTML error page with some info about the circumstances that caused the error with a referenced CSS style sheet and a JPEG logo.</p> <p>In the CoreWaapService custom resource specify something like this:</p> <pre><code>webResources:\nconfigMap: \"web-resources-config-map\"\npath: \"/resources/\"\nstaticFiles:\n- key: \"style.css\"\n- key: \"logo.jpg\"\nerrorPages:\n- key: \"error4xx.html\"\nstatusCode: \"4xx\"\n</code></pre> <p>And specify the resources in a config map like this:</p> <pre><code>apiVersion: v1\nkind: ConfigMap\nmetadata:\nname: \"web-resources-config-map\"\nnamespace: \"your-namespace\"\ndata:\nstyle.css: |\nbody { color: green }\nerror4xx.html: |\n&lt;html&gt;\n&lt;head&gt;\n&lt;title&gt;Error Page 4xx&lt;/title&gt;\n&lt;link rel=\"stylesheet\" type=\"text/css\" href=\"/resources/style.css\"/&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;h1&gt;Error Page 4xx&lt;/h1&gt;\n&lt;p&gt;backend status code: %RESPONSE_CODE%&lt;/p&gt;\n&lt;img src=\"/resources/logo.jpg\"&gt;\n&lt;/body&gt;\n&lt;/html&gt;\nbinaryData:\nlogo.jpg: |\n&lt;base64-encoded-jpeg-image&gt;\n</code></pre> <p>Note that you could use any of the Envoy \"%...%\" variables in the error page that can e.g. be used to configure an access log in Envoy.</p> <p>Static resources are, of course, also accessible without having to define an error page, i.e. also static HTML pages could be defined and used as static resources.</p>"},{"location":"error-pages-static-files/#json-error-page-for-504-error-mapped-to-500","title":"JSON error page for 504 error mapped to 500","text":"<p>In the CoreWaapService custom resource specify something like this:</p> <pre><code>webResources:\nconfigMap: \"web-resources-config-map\"\npath: \"/resources/\"\nerrorPages:\n- key: \"error504.json\"\nstatusCode: \"504\"\nmappedStatusCode: 500\n</code></pre> <p>And specify the resources in a config map like this:</p> <pre><code>apiVersion: v1\nkind: ConfigMap\nmetadata:\nname: \"web-resources-config-map\"\nnamespace: \"your-namespace\"\ndata:\nerror504.json: |\n{\n\"code\":\"%RESPONSE_CODE%\",\n\"message\":\"Gateway Timeout\"\n}\n</code></pre>"},{"location":"helm-CHANGELOG/","title":"Changelog","text":""},{"location":"helm-CHANGELOG/#101-2024-09-05","title":"1.0.1 - 2024-09-05","text":""},{"location":"helm-CHANGELOG/#contents","title":"Contents","text":"<ul> <li>Operator 1.0.0</li> <li>Core WAAP 1.1.8</li> </ul>"},{"location":"helm-CHANGELOG/#100-2024-09-05","title":"1.0.0 - 2024-09-05","text":""},{"location":"helm-CHANGELOG/#contents_1","title":"Contents","text":"<ul> <li>Operator 1.0.0</li> <li>Core WAAP 1.1.8</li> </ul>"},{"location":"helm-CHANGELOG/#0100-2024-08-05","title":"0.10.0 - 2024-08-05","text":""},{"location":"helm-CHANGELOG/#changed","title":"Changed","text":"<ul> <li>Purely internal test release.</li> </ul>"},{"location":"helm-CHANGELOG/#090-2024-07-30","title":"0.9.0 - 2024-07-30","text":""},{"location":"helm-CHANGELOG/#added","title":"Added","text":"<ul> <li>Initial release of Helm chart independently of operator release.</li> <li>Helm chart releases now available on Azure Helm chart repository.</li> </ul> <p>Operator: https://git.u-s-p.local/core-waap/core-waap-operator/-/blob/main/CHANGELOG.md</p> <p>Core WAAP: https://git.u-s-p.local/core-waap/core-waap-build/-/blob/main/CHANGELOG.md</p>"},{"location":"helm-values/","title":"usp-core-waap-operator","text":"<p>Helm chart for the USP Core WAAP operator.</p>"},{"location":"helm-values/#values","title":"Values","text":"Key Type Default Description operator.config object <code>{\"waapSpecDefaults\":{\"image\":\"uspregistry.azurecr.io/usp/core/waap/usp-core-waap:1.1.8\"},\"watchedNamespaces\":[]}</code> Settings for operator config operator.config.waapSpecDefaults object <code>{\"image\":\"uspregistry.azurecr.io/usp/core/waap/usp-core-waap:1.1.8\"}</code> Optional: operation defaults, see field 'operation' in the Core WAAP CRD for possible settings and merge behavior operator.config.watchedNamespaces list <code>[]</code> Optional: list of namespaces for which to process custom resources or ingress manifests (defaults to all). operator.image string <code>\"uspregistry.azurecr.io/usp/core/waap/usp-core-waap-operator\"</code> Operator container image operator.imagePullSecretName string <code>\"\"</code> Optional: Name of the image pull secret to be used by the service account operator.namespace string <code>\"usp-core-waap-operator\"</code> Operator deployment namespace operator.resources object <code>{\"limits\":{\"cpu\":\"\",\"memory\":\"\"},\"request\":{\"cpu\":\"\",\"memory\":\"\"}}</code> Resource settings for WAAP operator NOTE: If the fields are left empty, the operator deployment will not contain the corresponding settings,       and as a consequence, the clusters own defaults will apply. operator.resources.limits.cpu string <code>\"\"</code> CPU resource limit per request operator.resources.limits.memory string <code>\"\"</code> Memory resource limit per request operator.resources.request.cpu string <code>\"\"</code> CPU resources required per request operator.resources.request.memory string <code>\"\"</code> Memory resources required per request operator.serviceAccount string <code>\"usp-core-waap-operator\"</code> Name of service account operator.version string <code>\"1.0.0\"</code> Version of operator to deploy <p>Autogenerated from chart metadata using helm-docs v1.13.1</p>"},{"location":"helm/","title":"Helm Charts","text":"<p>Install the operator via Helm using the Helm charts. The Helm charts are available on the USP OCI repository:</p> <ul> <li><code>oci://uspregistry.azurecr.io/helm/usp/core/waap/usp-core-waap-operator</code></li> </ul>"},{"location":"helm/#download-pull","title":"Download (pull)","text":"<p>To just download the Helm charts (latest release):</p> <pre><code>helm pull oci://uspregistry.azurecr.io/helm/usp/core/waap/usp-core-waap-operator\n</code></pre>"},{"location":"helm/#install-operator","title":"Install operator","text":"<p>To install the latest operator release:</p> <pre><code>helm install usp-core-waap-operator oci://uspregistry.azurecr.io/helm/usp/core/waap/usp-core-waap-operator --version 1.0.1\n</code></pre> <p>To override the operator configuration settings in the <code>operator-configuration.yaml</code> Helm template, use a local values file, e.g. <code>custom-values.yaml</code> with the <code>-f</code> Helm CLI argument:</p> <pre><code>helm install -f custom-values.yaml usp-core-waap-operator oci://uspregistry.azurecr.io/helm/usp/core/waap/usp-core-waap-operator --version 1.0.1\n</code></pre>"},{"location":"helm/#information","title":"Information","text":"<p>You can use <code>helm template</code> to just render the templates to the console in order to look at the contents, before  actually installing the operator:</p> <pre><code>helm template -f custom-values.yaml usp-core-waap-operator oci://uspregistry.azurecr.io/helm/usp/core/waap/usp-core-waap-operator --version 1.0.1\n</code></pre>"},{"location":"logs-metrics/","title":"Logs and Metrics","text":"<p>Logs about Core WAAP's http request/response processing and possible security policy violation events are crucial for the visibility of the target web application or API operation. Core WAAP Operator logs allow to monitor configuration change events. Besides logs, metrics offer quantitative data on aspects like traffic volume, response times, and blocked threats, enabling the monitoring of Core WAAP effectiveness over time and identifying trends or anomalies.</p> <p>The Core WAAP components log to the standard out in JSON format and can be used by customers log stack for further processing and visualization. Metrics can be scraped with Prometheus for example. Therefore Core WAAP's adminInterface has to be configured accordingly. Therefore check the API Description for <code>spec.operation.adminInterfaceService</code>. Metrics are exposed on the admin interface <code>/stats/prometheus</code></p> <p>How the log and monitoring stack is beyond the scope of this documentation. We simply provide examples for OpenSearch and Grafana which can be downloaded here.</p>"},{"location":"native-config-post-processing/","title":"Native Config Post-Processing (NCPP)","text":"<p>This feature is very helpful in essentially these use cases:</p> <ul> <li>Quick workarounds for issues in production.</li> <li>Quick and flexible integrations of something new.</li> </ul> <p>Plus generally using features of the underlying Envoy that are not (yet) configurable via the Core WAAP custom resource, for example, for tuning performance or to log extra information in the access log, and so on...</p>"},{"location":"native-config-post-processing/#introduction","title":"Introduction","text":"<p>The Core WAAP Operator translates the Core WAAP custom resource (CR) to native configuration of the Enovy proxy. The resulting native configuration is also in the form of YAML files.</p> <p>The \"native configuration post-processing\" feature allows to adapt the generated Envoy configuration before it is deployed, using JavaScript. This allows to freely modify the effective configuration by adding, changing or removing arbitrary settings.</p> <p>A very basic example to make the concept clear: Below the beginning of the Envoy config file <code>envoy.yaml</code> as it is currently generated by default:</p> <pre><code>node:\nid: \"core.waap.id\"\ncluster: \"core.waap.cluster\"\n# ... more generated settings ...\n</code></pre> <p>Suppose that for some reason you wanted to change the <code>id</code> to <code>core.waap.id.modified-by-post-processing</code> (not a practically useful example, just to explain the concept, more realistic examples further below). Then you could configure the following in the <code>nativeConfigPostProcessing</code> section of the CR:</p> <pre><code># ... other settings (routes, authentications, etc.) ...\n\nnativeConfigPostProcessing:\n- \"envoy.node.id = 'core.waap.id.modified-by-post-processing'\"\n</code></pre> <p>The configured JavaScript gets a variable <code>envoy</code> at runtime that contains the parsed YAML content of <code>envoy.yaml</code>. Hence <code>envoy.node.id</code> selects the node ID in the YAML tree structure and setting it to a different value overwrites the previous value. The operator takes care of translating the JavaScript variables back to YAML files, i.e. in the end also generates an <code>envoy.yaml</code> that is then deployed:</p> <pre><code>node:\nid: \"core.waap.id.modified-by-post-processing\"\ncluster: \"core.waap.cluster\"\n# ... more generated settings ...\n</code></pre> <p>Currently, three native Enovy YAML files and corresponding JavaScript variables are generated:</p> <ul> <li><code>envoy.yaml</code> (<code>envoy</code>): Root Envoy configuration with some basic settings, also references the two files below.</li> <li><code>lds.yaml</code> (<code>lds</code>): Envoy listener configuration (\"frontend\"), incl. filter chains.</li> <li><code>cds.yaml</code> (<code>cds</code>): Envoy cluster configuration (\"backends\").</li> </ul> <p>In the following a couple of real examples that were needed and worked at the time. Note that they may not be needed or not work any more by the time you are reading this, but they should be specific enough to show the possibilities.</p> <p>After that, some general comments about use cases, best practices and potential future improvements.</p>"},{"location":"native-config-post-processing/#examples","title":"Examples","text":""},{"location":"native-config-post-processing/#example-1-simple-file-upload-in-large-chunks","title":"Example 1 (simple): File upload in large chunks","text":"<p>By default, Envoy has a limit on uploads to chunks of maximally 1 MB when in combination with the Coraza WASM filter (CRS enabled). This default behavior can be changed by explicitly setting <code>perConnectionBufferLimitBytes</code> on the listener, in the example below set to 10 MB in <code>lds.yaml</code>:</p> <pre><code>resources:\n- '@type': \"type.googleapis.com/envoy.config.listener.v3.Listener\"\nname: \"core.waap.listener\"\naddress:\nsocketAddress:\naddress: \"0.0.0.0\"\nportValue: 8080\nfilterChains:\n# ... more config omitted ...\nperConnectionBufferLimitBytes: 10485760\n</code></pre> <p>As of writing this, there is only a single listener resource in the <code>lds.yaml</code>, hence the native config post-processing can be written like this:</p> <pre><code>nativeConfigPostProcessing:\n- \"lds.resources[0].perConnectionBufferLimitBytes = 10485760\"\n</code></pre>"},{"location":"native-config-post-processing/#example-2-complex-with-lua-openid-connect-login-at-root-location-with-aci-functionality-as-lua-filter","title":"Example 2 (complex, with Lua): OpenID Connect login at root location with ACI functionality as Lua filter","text":"<p>This example is around OpenID Connect / OAuth 2.0 login via the corresponding Envoy authentication filter. An additional filter in the Lua script language is added via JavaScript which does roughly the following:</p> <ul> <li>Certain unauthenticated requests receive a HTTP 419 status code instead of the HTTP 302 redirect from the OAuth filter.</li> <li>Certain unauthenticated requests receive a HTTP 403 instead of the redirect and they also receive two additional response headers.</li> </ul> <p>Context is Microsoft Office in combination with WebDAV; ACI = Adaptive Client Integration.</p> <p>Note that the implementation is split up into two native config post-processing JavaScripts, one that defines the Lua script as a JavaScript variable and a second one that does the changes to the native Envoy config in the <code>lds.yaml</code>:</p> <pre><code>  nativeConfigPostProcessing:\n- |\nconst luaScript = `\nfunction envoy_on_request(request_handle)\n-- set the route and x_requested_with_header in the dynamic metadata to use later in the response handler\nlocal route = request_handle:headers():get(\":path\")\nlocal x_requested_with_header = request_handle:headers():get(\"x-requested-with\")\nrequest_handle:streamInfo():dynamicMetadata():set(\"envoy.filters.http.lua\", \"ACI.request.path\", route)\nif x_requested_with_header ~= nil and string.lower(x_requested_with_header) == \"xmlhttprequest\" then\nrequest_handle:streamInfo():dynamicMetadata():set(\"envoy.filters.http.lua\", \"ACI.XHR\", true)\nelse\nrequest_handle:streamInfo():dynamicMetadata():set(\"envoy.filters.http.lua\", \"ACI.XHR\", false)\nend\nend\n\nfunction envoy_on_response(response_handle)\nlocal route = response_handle:streamInfo():dynamicMetadata():get(\"envoy.filters.http.lua\")[\"ACI.request.path\"]\nlocal xhr = response_handle:streamInfo():dynamicMetadata():get(\"envoy.filters.http.lua\")[\"ACI.XHR\"]\nlocal status = response_handle:headers():get(\":status\")\nlocal auth_endpoint = \"https://oauth-keycloak-10-0-2-15.nip.io:8443/realms/core-waap-testing/protocol/openid-connect/auth\"\n\n-- detect login redirect\nif status == \"302\" then\nlocal location = response_handle:headers():get(\"location\")\nif string.find(location, auth_endpoint, 1 , true) ~= nil then\n\n-- handle XHR requests\nif xhr then\nresponse_handle:headers():replace(\":status\", \"419\")\nreturn\nend\n\n-- handle server sent events\nif string.find(route, \"/sse/\") ~= nil then\nresponse_handle:headers():replace(\":status\", \"419\")\nreturn\nend\n\n-- special treatment for request of non-browser-clients like Word and Excel\nif string.find(route,\"/webdav\") ~= nil then\nresponse_handle:headers():replace(\":status\", \"403\")\nresponse_handle:headers():add(\"X-FORMS_BASED_AUTH_RETURN_URL\", route)\nresponse_handle:headers():add(\"X-FORMS_BASED_AUTH_REQUIRED\", auth_endpoint)\nreturn\nend\nend\nend\nend\n`\n- |\nlds.resources[0].filterChains[0].filters[0].typedConfig.httpFilters.unshift({\n'name': 'envoy.filters.http.lua',\n'typed_config': {\n'@type': 'type.googleapis.com/envoy.extensions.filters.http.lua.v3.Lua',\n'source_codes': {\n'aci.lua': {\n'inline_string': luaScript\n}\n}\n}\n});\nvar aciKey = 'envoy.filters.http.lua';\nvar aciValue = {\n'@type': 'type.googleapis.com/envoy.extensions.filters.http.lua.v3.LuaPerRoute',\n'name': 'aci.lua'\n};\nconst routes =\nlds.resources[0].filterChains[0].filters[0].typedConfig.routeConfig.virtualHosts[0].routes;\nroutes.forEach((route) =&gt; route.typedPerFilterConfig[aciKey] = aciValue);\n</code></pre>"},{"location":"native-config-post-processing/#general-comments","title":"General Comments","text":""},{"location":"native-config-post-processing/#use-cases-and-best-practices","title":"Use cases and best practices","text":""},{"location":"native-config-post-processing/#quick-workarounds-for-issues-in-production","title":"Quick workarounds for issues in production","text":"<p>This allows to fix at least some imminent problems without the need to create a bugfix release immediately.</p> <p>This can be especially useful in cases where a fix cannot be easily tested outside production, reducing turnaround times and thus a quicker fix in production.</p> <p>Obviously, in most cases the idea is to afterward include a corresponding fix into the next regular Core WAAP release.</p>"},{"location":"native-config-post-processing/#quick-and-flexible-integrations-of-something-new","title":"Quick and flexible integrations of something new","text":"<p>A PoC is maybe the most general example for this use case, where integration issues can be solved ad-hoc whenever they occur without immediate need for a release, again also reducing turnaround times in cases where the feature cannot be easily/immediately tested outside the enviroment of the customer.</p> <p>Depending on the nature of the integration, it may later make sense to include new features into the Core WAAP that cover the new intergrations, namely if the integrations are of a kind that is generally useful, or are the better choice for other reasons.</p> <p>Side remark: Note that this use case is often also interesting internally at USP because it allows to explore new settings sometimes more quickly than operating directly with native Envoy config.</p>"},{"location":"native-config-post-processing/#tuning-debugging-existing-installations","title":"Tuning / debugging existing installations","text":"<p>Use features that are present in the underlying Envoy but not (yet) configurable via the Core WAAP custom resource.</p>"},{"location":"native-config-post-processing/#future-improvements","title":"Future Improvements","text":"<p>We are evaluating various ways to make using this feature generally more easy and also more robust regarding new Core WAAP releases.</p> <p>Note that the generated native Envoy config is subject to change:</p> <p>Its structure may change, due to changes in the Core WAAP Operator or also due to changes in the underlying Envoy itself, hence it is not an API that is in any way guaranteed to remain stable, while in practice many things will still be quite stable most of the time.</p> <p>As an example of potential future enhancements, JavaScript functions may be offered to get/set the Core Rule Set (CRS) settings of the Coraza filter more easily. And/or similar JavaScript functions that make it both more simple and potentially also more robust to get/set some specific or general items in the native Envoy config.</p>"},{"location":"operator-CHANGELOG/","title":"Changelog","text":"<p>Breaking changes/additions may require to adapt existing configurations when updating.</p>"},{"location":"operator-CHANGELOG/#100-2024-09-05","title":"1.0.0 - 2024-09-05","text":""},{"location":"operator-CHANGELOG/#contents","title":"Contents","text":"<ul> <li>Spec library 1.0.0 (Envoy config 1.31.0 CRS 4.3.0)</li> <li>Core WAAP 1.1.8 (Envoy 1.31.0 CRS 4.3.0)</li> </ul>"},{"location":"operator-CHANGELOG/#changed","title":"Changed","text":"<ul> <li>Breaking: Move almost all operator settings and annotations to Core WAAP spec under <code>operation</code> with default settings definable in the operator config map under <code>config.coreWaapDefaults</code> (#282449)</li> <li>Only a single operator config setting remains of the old settings: <code>watchedNamespaces</code> (list of watched namespaces optional default empty which means to watch all namespaces).</li> <li>No annotations remain.</li> <li>In the Core WAAP spec under <code>operation</code> as well as in the defaults in the operator config map under <code>config.coreWaapDefaults</code> there are also Kubernetes settings (<code>replicas</code> <code>resources</code> <code>tolerations</code> <code>priorityClassName</code> and <code>affinity</code>) see CRD for full detail.</li> <li>NOTE: Previous operator config for <code>resources</code> mistakenly used <code>request</code> (singular) instead of <code>requests</code> (plural) please correct when migrating settings.</li> <li>Breaking: CRS 4.3.0 (#288942)</li> <li>Breaking: Change various CRS defaults (#287832)</li> <li>Change <code>enabledRequestRules</code> and <code>enabledResponseRules</code> now enums instead of numbers</li> <li>Rename <code>requestBodyLimit</code> and <code>responseBodyLimit</code> to <code>requestBodyLimitKb</code> resp. <code>responseBodyLimitKb</code> </li> <li><code>hostnames</code> setting optional defaults to <code>*</code> (#287832)</li> </ul>"},{"location":"operator-CHANGELOG/#added","title":"Added","text":"<ul> <li>Breaking: Add CSRF protection filter <code>csrfPolicy</code> active by default (#289461)</li> <li>Breaking: Add global HTTP header filtering <code>headerFiltering</code> active by default (#286882)</li> <li>Breaking: Add universal HTTP header validator (UHV) active by default (#289581)</li> <li>Add mappable custom error pages with dynamic content and static file resources <code>webResources</code> (#289442)</li> <li>Add settings to expose Envoy admin interface as Kubernetes service <code>operation.adminInterfaceServices</code> (#289346)</li> <li>Allow to skip CRS body scanning per location / HTTP methods <code>crs.requestBodyAccessExceptions</code> (#289373)</li> <li>Allow to disable the CRS engine per Core WAAP route <code>routesindex.crs</code> (#289373)</li> <li>Add Kubernetes scheduling properties (<code>replicas</code> <code>resources</code> <code>tolerations</code> <code>priorityClassName</code> and <code>affinity</code>) to <code>operation</code> as well as in the defaults in the operator config map under <code>config.coreWaapDefaults</code> see CRD for full detail (#282449)</li> </ul>"},{"location":"operator-CHANGELOG/#fixed","title":"Fixed","text":"<ul> <li>Operator properly compares actual &amp; desired values of cpu &amp; memory resource requests to avoid endless reconcile loop (#289318).</li> <li>CRS autolearning removes the query part of the location and URL-decodes the location (#289357)</li> <li>CRS settings <code>requestBodyLimit</code> and <code>responseBodyLimit</code> are now interpreted as kb as documented no longer as bytes (plus renamed to <code>requestBodyLimitKb</code> and <code>responseBodyLimitKb</code> for clarity) (#287832)</li> <li>If allowed methods are specified and a request comes in with a method that is not allowed no longer responds with 404 (Not Found) but with a 405 (Method not allowed) (#256147)</li> <li>Fix bug with authentication with public superlocations (#289691)</li> </ul>"},{"location":"operator-CHANGELOG/#0101-2024-08-05","title":"0.10.1 - 2024-08-05","text":""},{"location":"operator-CHANGELOG/#contents_1","title":"Contents","text":"<ul> <li>Spec library 0.8.1 (Envoy config 1.31.0 CRS 4.3.0)</li> <li>Core WAAP 1.1.6 (Envoy 1.31.0 CRS 4.3.0)</li> </ul>"},{"location":"operator-CHANGELOG/#0100-2024-08-05","title":"0.10.0 - 2024-08-05","text":""},{"location":"operator-CHANGELOG/#contents_2","title":"Contents","text":"<ul> <li>Spec library 0.8.0 (Envoy config 1.30.1 CRS 4.3.0)</li> <li>Core WAAP 1.1.6 (Envoy 1.31.0 CRS 4.3.0)</li> </ul>"},{"location":"operator-CHANGELOG/#changed_1","title":"Changed","text":"<ul> <li>Fixed spec lib version for internal release. </li> </ul>"},{"location":"operator-CHANGELOG/#080-2024-05-23","title":"0.8.0 - 2024-05-23","text":""},{"location":"operator-CHANGELOG/#contents_3","title":"Contents","text":"<ul> <li>Core WAAP 1.1.5 (Envoy 1.30.1)</li> <li>Spec library 0.7.0 (Envoy config 1.30.1 CRS 4.0.0-RC2)</li> <li>Helm Charts 0.8.0</li> </ul>"},{"location":"operator-CHANGELOG/#changed_2","title":"Changed","text":"<ul> <li>Publish to <code>uspregistry.azurecr.io/usp/core/waap/usp-core-waap-operator</code> no longer to <code>quay.io/usp/usp-core-waap-operator</code> (#289345)</li> </ul>"},{"location":"operator-CHANGELOG/#fixed_1","title":"Fixed","text":"<ul> <li>Fix CRS in mode detect (#289258)</li> </ul>"},{"location":"operator-CHANGELOG/#added_1","title":"Added","text":"<ul> <li>JavaScripts for post-processing generated Envoy config (#289260)</li> </ul>"},{"location":"operator-CHANGELOG/#070-2024-04-29","title":"0.7.0 - 2024-04-29","text":""},{"location":"operator-CHANGELOG/#contents_4","title":"Contents","text":"<ul> <li>Core WAAP 1.1.5 (Envoy 1.30.1)</li> <li>Spec library 0.6.0 (Envoy config 1.30.1 CRS 4.0.0-RC2)</li> <li>Helm Charts 0.7.4</li> </ul>"},{"location":"operator-CHANGELOG/#changed_3","title":"Changed","text":"<ul> <li>Breaking: Default upstream protocol HTTP/2 (previously HTTP/1.1) (#285763)</li> </ul>"},{"location":"operator-CHANGELOG/#added_2","title":"Added","text":"<ul> <li>Add \"serviceAnnotations\" config setting and corresponding \"service-annotations\" annotation (#285763)</li> <li>Add origin IP allow/deny (#286876)</li> <li>Add allowed HTTP methods per route (#256147)</li> <li>Add autoHostRewrite configurable (if true set X-Forwarded-Host header) (#287831 #288623)</li> <li>Add downstream automatic preference of HTTP/2; upstream HTTP/2 (default) HTTP/1.1 or automatic selection via ALPN (requires TLS) (#285763)</li> <li>Add features to CRS autolearn CLI (#288611)</li> </ul>"},{"location":"operator-CHANGELOG/#fixed_2","title":"Fixed","text":"<ul> <li>At JWT-only authentication forward JWT upstream if configured (#288135)</li> <li>Add missing CRS rules (#288611)</li> </ul>"},{"location":"operator-CHANGELOG/#061-2024-03-28","title":"0.6.1 - 2024-03-28","text":""},{"location":"operator-CHANGELOG/#contents_5","title":"Contents","text":"<ul> <li>Core WAAP 1.1.2</li> <li>Spec library 0.5.0 (Envoy config 1.29.x)</li> </ul>"},{"location":"operator-CHANGELOG/#fixed_3","title":"Fixed","text":"<ul> <li>Missing version suffix (e.g. \":1.1.2\") in the \"envoy.image\" configuration setting could lead to an invalid version   label in the generated ConfigMap object leading to a failed deployment. Now the version will fall back to \"latest\"   if no version is specified for the image.</li> </ul>"},{"location":"operator-CHANGELOG/#060-2024-03-25","title":"0.6.0 - 2024-03-25","text":""},{"location":"operator-CHANGELOG/#contents_6","title":"Contents","text":"<ul> <li>Core WAAP 1.1.2</li> <li>Spec library 0.5.0 (Envoy config 1.29.x)</li> </ul>"},{"location":"operator-CHANGELOG/#changed_4","title":"Changed","text":"<ul> <li>Breaking: Use plural for lists in WAAP Spec (authentications audiences) (#285960)</li> <li>Breaking: Default for \"replicas\" is no longer 1 but to not set it so that an HPA (Horizontal Pod Autoscaler) can manage it (#282428)</li> <li>Breaking: The name in the operator CR (custom resource) is ignored as well as the corresponding annotation instead uses the metadata name of the resource \"CoreWaapService\" (the Core WAAP CR) as name for Pods Service ReplicaSets etc. (#284588)</li> <li>Breaking: Replace authentication tokenEndpointAuthType QUERY with BODY (#285777)</li> <li>Improve validation of WAAP Spec and more info in generated CRD (#282608)</li> </ul>"},{"location":"operator-CHANGELOG/#added_3","title":"Added","text":"<ul> <li>Add header match for routes (#285016)</li> <li>Add authentication useRefreshToken flag (#285777)</li> <li>Allow plain http jwksEndpoint in JWT-auth-only use case (#285962)</li> </ul>"},{"location":"operator-CHANGELOG/#fixed_4","title":"Fixed","text":"<ul> <li>Support multiple instances in same namespace (#284588)</li> </ul>"},{"location":"operator-CHANGELOG/#050-2024-03-05","title":"0.5.0 - 2024-03-05","text":""},{"location":"operator-CHANGELOG/#contents_7","title":"Contents","text":"<ul> <li>Core WAAP 1.1.0</li> <li>Spec library 0.4.0 (Envoy config 1.29.x)</li> </ul>"},{"location":"operator-CHANGELOG/#changed_5","title":"Changed","text":"<ul> <li>Breaking: If <code>caCertificatesConfigMapName</code> is set also <code>caCertificateKeyInConfigMap</code> must be set (or corresponding annotations) (#282762)</li> </ul>"},{"location":"operator-CHANGELOG/#added_4","title":"Added","text":"<ul> <li>Set service account name and whether to automount token (#282286)</li> </ul>"},{"location":"operator-CHANGELOG/#fixed_5","title":"Fixed","text":"<ul> <li>Mounted CA certificates always under <code>/etc/ssl/certs/ca-certificates.crt</code> (#282762)</li> </ul>"},{"location":"operator-CHANGELOG/#041-2024-02-27","title":"0.4.1 - 2024-02-27","text":""},{"location":"operator-CHANGELOG/#contents_8","title":"Contents","text":"<ul> <li>Core WAAP 1.1.0</li> <li>Spec library 0.3.0 (Envoy config 1.29.x)</li> </ul>"},{"location":"operator-CHANGELOG/#fixed_6","title":"Fixed","text":"<ul> <li>Fixed build problem.</li> </ul>"},{"location":"operator-CHANGELOG/#040-2024-02-26","title":"0.4.0 - 2024-02-26","text":""},{"location":"operator-CHANGELOG/#contents_9","title":"Contents","text":"<ul> <li>Core WAAP 1.1.0</li> <li>Spec library 0.2.2</li> </ul>"},{"location":"operator-CHANGELOG/#added_5","title":"Added","text":"<ul> <li>TLS support for upstream backends.</li> </ul>"},{"location":"operator-CHANGELOG/#030-2024-02-23","title":"0.3.0 - 2024-02-23","text":""},{"location":"operator-CHANGELOG/#contents_10","title":"Contents","text":"<ul> <li>Core WAAP 1.1.0</li> <li>Spec library 0.2.</li> </ul>"},{"location":"operator-CHANGELOG/#changed_6","title":"Changed","text":"<ul> <li>Breaking: The \"podName\" operator setting has been renamed to just \"name\". The custom annotation to override    this setting has been adapted accordingly from \"core.waap.u-s-p.ch/pod-name\" to \"core.waap.u-s-p.ch/name\".</li> </ul>"},{"location":"operator-CHANGELOG/#added_6","title":"Added","text":"<ul> <li>New operator setting \"envoy/labels\" (or annotation \"core.waap.u-s-p.ch/labels\") allows to define one or multiple   custom labels for the Envoy pods.</li> </ul>"},{"location":"operator-CHANGELOG/#fixed_7","title":"Fixed","text":"<ul> <li>The \"name\" operator configuration setting (formerly \"podName\") is now also properly used for the name of the \"Service\"   and the \"ConfigMap\" objects of the Core WAAP deployment. This allows to have multiple Core WAAP deployments within the same   application namespace. </li> </ul>"},{"location":"operator-CHANGELOG/#020-2024-02-12","title":"0.2.0 - 2024-02-12","text":""},{"location":"operator-CHANGELOG/#contents_11","title":"Contents","text":"<ul> <li>Core WAAP 1.1.0</li> <li>Spec library 0.2.0</li> </ul>"},{"location":"operator-CHANGELOG/#changed_7","title":"Changed","text":"<ul> <li>Breaking: Renamed everything to \"core-waap-operator\".  </li> </ul>"},{"location":"operator-CHANGELOG/#011-2024-01-25","title":"0.1.1 - 2024-01-25","text":""},{"location":"operator-CHANGELOG/#contents_12","title":"Contents","text":"<ul> <li>Core WAAP 1.0.6</li> <li>Spec library 0.0.8</li> </ul>"},{"location":"operator-CHANGELOG/#added_7","title":"Added","text":"<ul> <li>Added Envoy configuration for custom CA certificates. </li> </ul>"},{"location":"operator-CHANGELOG/#010-2024-01-18","title":"0.1.0 - 2024-01-18","text":""},{"location":"operator-CHANGELOG/#contents_13","title":"Contents","text":"<ul> <li>Core WAAP 1.0.6</li> <li>Spec library 0.0.7</li> </ul>"},{"location":"operator-CHANGELOG/#added_8","title":"Added","text":"<ul> <li>Added configuration option and annotation for custom CA truststore.</li> </ul>"},{"location":"operator-CHANGELOG/#009-2024-01-11","title":"0.0.9 - 2024-01-11","text":""},{"location":"operator-CHANGELOG/#changed_8","title":"Changed","text":"<ul> <li>Updated CRD (obsolete status fields replaced with single message).</li> </ul>"},{"location":"operator-CHANGELOG/#added_9","title":"Added","text":"<ul> <li>Added configuration option and annotation for number of replicas.</li> <li>Added support for mounting secrets for OIDC authentication.</li> </ul>"},{"location":"operator-CHANGELOG/#008-2024-01-03","title":"0.0.8 - 2024-01-03","text":""},{"location":"operator-CHANGELOG/#fixed_8","title":"Fixed","text":"<ul> <li>Fixed invalid resource format handling</li> </ul>"},{"location":"operator-CHANGELOG/#007-2024-12-19","title":"0.0.7 - 2024-12-19","text":""},{"location":"operator-CHANGELOG/#fixed_9","title":"Fixed","text":"<ul> <li>Fixed invalid CR annotation name for image override</li> </ul>"},{"location":"operator-CHANGELOG/#006-2024-12-16","title":"0.0.6 - 2024-12-16","text":""},{"location":"operator-CHANGELOG/#fixed_10","title":"Fixed","text":"<ul> <li>Fixed copy-paste error with \"limits\" resources.</li> </ul>"},{"location":"operator-CHANGELOG/#005","title":"0.0.5","text":""},{"location":"operator-CHANGELOG/#added_10","title":"Added","text":"<ul> <li>Operator config map template with resources</li> <li>Operator config support for envoy resources (cpu memory)</li> <li>Operator config support for envoy pod name</li> <li>Envoy log format supports auto-learning CLI tool.</li> </ul>"},{"location":"operator-CHANGELOG/#004","title":"0.0.4","text":"<ul> <li>Internal testing release.</li> </ul>"},{"location":"operator-CHANGELOG/#003","title":"0.0.3","text":"<ul> <li>First usable native build.</li> <li>Uses Envoy 1.29 (no hot reload for normal config changes)</li> </ul>"},{"location":"operator-CHANGELOG/#002","title":"0.0.2","text":"<ul> <li>Minor extensions.</li> </ul>"},{"location":"operator-CHANGELOG/#001","title":"0.0.1","text":"<ul> <li>Experimental release for Envoy 1.28.</li> </ul> <p>1.0.0: https://git.u-s-p.local/core-waap/core-waap-operator/-/tags/1.0.0 0.10.1: https://git.u-s-p.local/core-waap/core-waap-operator/-/tags/0.10.1 0.10.0: https://git.u-s-p.local/core-waap/core-waap-operator/-/tags/0.10.0 0.8.0: https://git.u-s-p.local/core-waap/core-waap-operator/-/tags/0.8.0 0.7.0: https://git.u-s-p.local/core-waap/core-waap-operator/-/tags/0.7.0 0.6.1: https://git.u-s-p.local/core-waap/core-waap-operator/-/tags/0.6.1 0.6.0: https://git.u-s-p.local/core-waap/core-waap-operator/-/tags/0.6.0 0.5.0: https://git.u-s-p.local/core-waap/core-waap-operator/-/tags/0.5.0 0.4.1: https://git.u-s-p.local/core-waap/core-waap-operator/-/tags/0.4.1 0.4.0: https://git.u-s-p.local/core-waap/core-waap-operator/-/tags/0.4.0 0.3.0: https://git.u-s-p.local/core-waap/core-waap-operator/-/tags/0.3.0 0.2.0: https://git.u-s-p.local/core-waap/core-waap-operator/-/tags/0.2.0 0.1.1: https://git.u-s-p.local/core-waap/core-waap-operator/-/tags/0.1.1 0.1.0: https://git.u-s-p.local/core-waap/core-waap-operator/-/tags/0.1.0 0.0.9: https://git.u-s-p.local/core-waap/core-waap-operator/-/tags/0.0.9 0.0.8: https://git.u-s-p.local/core-waap/core-waap-operator/-/tags/0.0.8 0.0.7: https://git.u-s-p.local/core-waap/core-waap-operator/-/tags/0.0.7 0.0.6: https://git.u-s-p.local/core-waap/core-waap-operator/-/tags/0.0.6 0.0.5: https://git.u-s-p.local/core-waap/core-waap-operator/-/tags/0.0.5 0.0.4: https://git.u-s-p.local/core-waap/core-waap-operator/-/tags/0.0.4 0.0.3: https://git.u-s-p.local/core-waap/core-waap-operator/-/tags/0.0.3 0.0.2: https://git.u-s-p.local/core-waap/core-waap-operator/-/tags/0.0.2 0.0.1: https://git.u-s-p.local/core-waap/core-waap-operator/-/tags/0.0.1</p> <p>Core WAAP: https://git.u-s-p.local/core-waap/core-waap-build/-/blob/main/CHANGELOG.md</p> <p>Spec library: https://git.u-s-p.local/core-waap/core-waap-lib/-/blob/main/CHANGELOG.md</p> <p>CRS: https://github.com/coreruleset/coreruleset/releases</p>"},{"location":"operator/","title":"Operator Configuration","text":"<p>The operator configuration template contains many settings for the operator itself, and/or the WAAP Envoy deployments. The template bundled in the Helm charts contains default settings from the bundled <code>values.yaml</code> file, which will  usually have to be overridden for any custom deployments. To override the values, a local values YAML file can be used.</p>"},{"location":"upgrade/","title":"Updating Core WAAP Operator","text":"<p>To run a newer version of the Core WAAP Operator the corresponding helm chart can be used. Please check in the release notes what has changed and which settings may affect your deployed CoreWaapServices. In case of breaking changes, it is recommended to follow these instructions:</p> <ol> <li>Stop the Core WAAP Operator by scaling the deployment down to 0 replicas.</li> <li>Update the Core WAAP Operator by installing the new helm chart (ensure the CoreWaapService CustomResourceDefinition was updated.)</li> <li>Align the CoreWaapServices with the new schema according to the breaking changes in the release notes.</li> <li>Scale up the Core WAAP Operator deployment to 1 replica.</li> <li>Check the Core WAAP Operator Logs, to ensure that no error due to incompatibility occurs. Fix the remaining issues in the CoreWaapServices Custom Resources if required.</li> </ol> <p>Note: This procedure should prevent any downtime of a CoreWaapService. In case also a new Core WAAP Version is set, the pods will restart accordingly.</p>"},{"location":"upgrade/#core-waap-migration-guide","title":"Core WAAP Migration Guide","text":""},{"location":"upgrade/#core-waap-operator-080-to-100","title":"Core WAAP Operator 0.8.0 to 1.0.0","text":""},{"location":"upgrade/#operation-related-settings","title":"Operation-related settings","text":"<p>The following kinds of settings have been regularized:</p> <ul> <li>Instead of using annotations, use settings in the CoreWaapService CR under <code>spec.operation</code>. Note: This means that all Core WAAP annotations have to be removed during migration.</li> <li>The exact same settings can also be provided as defaults in the operator helm chart under <code>config.coreWaapDefaults</code>, replacing a number of previous operator settings. Note: All previous settings in the operator helm chart have to be moved to the new structure, even the ones that have no equivalent under <code>spec.operation</code>; best use the provided new helm chart as a basis.</li> </ul> <p>Generally, see the CoreWaapService CRD under <code>spec.operation</code> for all possible settings.</p> <p>Migration setting-by-setting:</p> <ul> <li>operator <code>envoy.image</code> / annotation <code>image</code> =&gt; <code>*.image</code>   (where <code>*.image</code> stands for <code>spec.operation.image</code> in the CoreWaapService CR, plus default in the operator helm chart at <code>config.coreWaapDefaults.image</code>, and similary in the following lines)</li> <li>annotations <code>version</code> and <code>registry</code> =&gt; no longer supported, specify in <code>*.image</code></li> <li>operator <code>envoy.labels</code> / annotation <code>labels</code> =&gt; <code>*.labels</code> (key/value)</li> <li>operator <code>serviceAnnotations</code> / annotation <code>service-annotations</code> =&gt; <code>*.serviceAnnotations</code> (key/value)</li> <li>operator <code>envoy.servicePort</code> and <code>envoy.listenerPort</code> / annotation <code>service-port</code> and <code>listener-port</code> =&gt; <code>*.port</code> (can no longer be set to different values, no use case)</li> <li>operator <code>envoy.serviceAdminPort</code> and <code>envoy.listenerAdminPort</code> / annotation <code>admin-service-port</code> and <code>admin-listener-port</code> =&gt; <code>*.adminInterfaceService.port</code> (can also no longer be set to different values, no use case)</li> <li><code>envoy.replicas</code> / annotation <code>replicas</code> =&gt; <code>*.replicas</code></li> <li>operator <code>envoy.resources.*</code> / annotations <code>request-cpu</code>, <code>request-memory</code>, <code>limits-cpu</code>, <code>limits-memory</code> =&gt; <code>*.respources</code> (standard Kubernetes format; note that <code>request</code> in the old settings was wrong, in Kubernetes is plural <code>requests</code>)</li> <li>operator <code>operator.caCertificatesConfigMapName</code> / annotation <code>custom-cacerts</code> =&gt; <code>*.caCertificates.configMap</code></li> <li>operator <code>operator.caCertificateKeyInConfigMap</code> / annotation <code>custom-cacerts-key</code> =&gt; <code>*.caCertificates.key</code></li> </ul> <p>The setting <code>operator.watchedNamespaces</code> is now <code>config.watchedNamespaces</code>.</p>"},{"location":"upgrade/#crs-rules-are-now-enums","title":"CRS rules are now enums","text":"<ul> <li>CRS request and response rules are no longer integers but enums, see the CRD for values.</li> <li>Note: Because the default for request rules has changed to all activated by default, if you previously had listed all of them, there is need to list them now all as enum values, just omit the setting.</li> </ul>"},{"location":"upgrade/#general","title":"General","text":"<ul> <li>See the breaking changes in the changelog. For example, some of the security features that have been activated by default (header filtering, CRS, CSRF) typically have no impact in practice, but legacy components might fail to pass through.</li> </ul>"},{"location":"waap-CHANGELOG/","title":"Changelog","text":""},{"location":"waap-CHANGELOG/#118-2024-09-05","title":"1.1.8 - 2024-09-05","text":""},{"location":"waap-CHANGELOG/#added","title":"Added","text":"<ul> <li>Enable the Unified Header Validator (UHV) in envoy.</li> </ul>"},{"location":"waap-CHANGELOG/#117-2024-08-29","title":"1.1.7 - 2024-08-29","text":""},{"location":"waap-CHANGELOG/#changed","title":"Changed","text":"<ul> <li>Lua header filter: Add common WebSocket headers to the STANDARD allow class as well as to the default response headers.</li> </ul>"},{"location":"waap-CHANGELOG/#116-2024-08-06","title":"1.1.6 - 2024-08-06","text":""},{"location":"waap-CHANGELOG/#changed_1","title":"Changed","text":"<ul> <li>Update CRS to version v4.3.0</li> <li>Update OS image to alpine-3.20</li> <li>Update Envoy to version v1.31.0</li> </ul>"},{"location":"waap-CHANGELOG/#added_1","title":"Added","text":"<ul> <li>Allow to set the general/component log level using environmet variables</li> <li>Add Lua header filter</li> </ul>"},{"location":"waap-CHANGELOG/#115-2024-04-26","title":"1.1.5 - 2024-04-26","text":""},{"location":"waap-CHANGELOG/#changed_2","title":"Changed","text":"<ul> <li>Update Envoy to version v1.30.1</li> </ul>"},{"location":"waap-CHANGELOG/#114-2024-04-17","title":"1.1.4 - 2024-04-17","text":""},{"location":"waap-CHANGELOG/#fixed","title":"Fixed","text":"<ul> <li>Fix format of version information file /etc/usp-core-waap-release</li> </ul>"},{"location":"waap-CHANGELOG/#113-2024-04-17","title":"1.1.3 - 2024-04-17","text":""},{"location":"waap-CHANGELOG/#changed_3","title":"Changed","text":"<ul> <li>Update OS image to alpine-3.19</li> <li>Update Envoy to version v1.30.0</li> </ul>"},{"location":"waap-CHANGELOG/#111-2024-02-29","title":"1.1.1 - 2024-02-29","text":""},{"location":"waap-CHANGELOG/#changed_4","title":"Changed","text":"<ul> <li>Update Envoy to version v1.29.1</li> </ul>"},{"location":"waap-CHANGELOG/#added_2","title":"Added","text":"<ul> <li>Add version information file /etc/usp-core-waap-release</li> </ul>"},{"location":"waap-CHANGELOG/#110-2024-02-01","title":"1.1.0 - 2024-02-01","text":""},{"location":"waap-CHANGELOG/#added_3","title":"Added","text":""}]}